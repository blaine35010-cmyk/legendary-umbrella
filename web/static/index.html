<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Court AI ‚Äî Query</title>
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:24px;max-width:1000px}
      textarea{width:100%;height:120px;font-size:14px;padding:8px;border:1px solid #ccc;border-radius:4px}
      pre{white-space:pre-wrap;background:#f6f8fa;padding:12px;border-radius:6px;max-height:600px;overflow-y:auto}
      .row{display:flex;gap:8px;align-items:center;margin:12px 0}
      input, select{padding:8px;border:1px solid #ccc;border-radius:4px}
      button{padding:8px 16px;background:#0366d6;color:white;border:none;border-radius:4px;cursor:pointer}
      button:hover{background:#0256bb}
      .tips{background:#fff8e1;padding:12px;border-left:4px solid #ffc107;margin:16px 0;border-radius:4px}
      h3{margin-top:24px}
    </style>
  </head>
  <body>
    <h2>‚öñÔ∏è Court AI ‚Äî Legal Analysis</h2>
    
    <div class="tips">
      <strong>üí° Tips for better results:</strong>
      <ul>
        <li><strong>Be specific:</strong> Instead of "prepare for trial," try "What custody arrangement did the court order and what visitation does the mother have?"</li>
        <li><strong>Ask about disputes:</strong> "What is the contempt allegation about?" or "What are the key facts supporting my position?"</li>
        <li><strong>Request strategies:</strong> "Based on the Final Decree, what should I prepare for the show cause hearing?"</li>
      </ul>
    </div>

    <div>
      <label><strong>Question</strong></label>
      <textarea id="question">What are the key facts in this case and what should I prepare for trial?</textarea>
    </div>
    
    <div class="row">
      <input id="path" placeholder="path contains (optional)" style="flex:1" />
      <select id="format">
        <option value="compact">compact</option>
        <option value="detailed">detailed</option>
      </select>
      <button id="ask">Ask Court AI</button>
    </div>

    <h3>Answer</h3>
    <pre id="answer">(no answer yet)</pre>
    <p id="sources" style="font-size:12px;color:#666"></p>

    <script>
      const btn = document.getElementById('ask');
      const answerEl = document.getElementById('answer');
      const sourcesEl = document.getElementById('sources');
      
      btn.onclick = async () => {
        const q = document.getElementById('question').value;
        const path = document.getElementById('path').value || null;
        const fmt = document.getElementById('format').value;
        
        answerEl.textContent = '‚è≥ Analyzing your documents with AI...';
        sourcesEl.textContent = '';
        
        try{
          const resp = await fetch('/ask',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({question:q, format:fmt, path_contains: path})
          });
          const j = await resp.json();
          
          if (j.error) {
            answerEl.textContent = 'Error: ' + j.error;
          } else {
            answerEl.textContent = j.answer || JSON.stringify(j);
            
            if (j.sources && j.sources.length > 0) {
              const sourceList = j.sources.map(s => {
                const filename = s.path.split('\\\\').pop();
                return filename;
              }).filter((v, i, a) => a.indexOf(v) === i);
              sourcesEl.textContent = 'Sources: ' + sourceList.join(', ');
            }
          }
        }catch(e){
          answerEl.textContent = 'Error: '+e.message;
        }
      };
      
      // Allow Enter key to submit
      document.getElementById('question').addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'Enter') {
          btn.click();
        }
      });
    </script>
  </body>
</html>
